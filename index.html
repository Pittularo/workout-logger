<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Monkeyer</title>
  <script>
  function get_date(){
    var ora = new Date().toLocaleDateString('fr-FR', {year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit'});
    //because french people are the only ones that can eliminate the comma with NO regret at all
    return ora;
   }
  </script>
</head>
<body onload="get_date1()" style="background-color: #d3a8ea;">

  <output id="output" hidden></output>

  <form 
  method="POST" 
  action="https://script.google.com/macros/s/AKfycbyNnXkpAM1_0ypMXYMDOgLCxprJ5a9J8XY3qZOmFkKfQHmKqn6-WbkxEgreIbtNcrP9/exec"
  id="formosa">
    <table class="_table">
      <thead>
        <th>Date</th><th>Exercise</th><th>Sets</th><th>Reps</th><th>Kg</th><th>Note</th>
      </thead>
      <tbody id="table_body">
        <tr>
          <td>
            <input type="text" id="date" name="date" readonly></td>
          <td>
            <input name="code" type="text" value="E008" required></td>
          <td>
            <input type="number" step="1" min="0" max="10" id="sets" name="sets" value="5" required></td> 
          <td>
            <input type="number" step="0.1" min="0" max="100" id="reps" name="reps" value="2" required></td>
          <td>
            <input type="number" step="1" min="0" max="100" id="kg" name="kg" value="10" required></td>
          <td>
            <input type="text" id="note" name="note" value=""></td>
          <td>
            <button onclick="create_tr()" type="button">+</button></td>
        </tr>
        <tr>
          <td>
            <input type="text" id="date" name="date" readonly></td>
          <td>
            <input name="code" type="text" value="E066" required></td>
          <td>
            <input type="number" step="1" min="0" max="10" id="sets" name="sets" value="6" required></td> 
          <td>
            <input type="number" step="0.1" min="0" max="100" id="reps" name="reps" value="6" required></td>
          <td>
            <input type="number" step="1" min="0" max="100" id="kg" name="kg" value="6" required></td>
          <td>
            <input type="text" id="note" name="note" value="nonono"></td>
          <td>
            <button onclick="create_tr()" type="button">+</button></td>
        </tr>
        <tr>
          <td>
            <input type="text" id="date" name="date" readonly></td>
          <td>
            <input name="code" type="text" value="E066" required></td>
          <td>
            <input type="number" step="1" min="0" max="10" id="sets" name="sets" value="6" required></td> 
          <td>
            <input type="number" step="0.1" min="0" max="100" id="reps" name="reps" value="6" required></td>
          <td>
            <input type="number" step="1" min="0" max="100" id="kg" name="kg" value="6" required></td>
          <td>
            <input type="text" id="note" name="note" value="nonono"></td>
          <td>
            <button onclick="create_tr()" type="button">+</button></td>
        </tr>
      </tbody>
    </table>
  <button type="submit" onclick="togliplaceholder()" value="Submit">Send</button>
  </form>
  <output id="output"></output>
  <script>
    window.addEventListener("load", function() {
      const form = document.getElementById('formosa');
      form.addEventListener("submit", function(e) {
        e.preventDefault();
        const formData = new FormData(form);
        const action = e.target.action;
        fetch(action, {
          method: 'POST',
          mode: "no-cors", // no-cors, *cors, same-origin
          headers: {'Content-Type': 'application/json',},
          body: formData,
        })
        .then(() => { // SE ELIMINASSIMO QUESTO THEN???????????????????????????????????????????????????????????????????????
          console.log(formData);
        })
      });
    });

  </script>
  <script>
  function get_date1(){
    table_body.lastElementChild.children[0].firstElementChild.value = get_date();
  }
  function create_tr(){
    let first_tr   = table_body.lastElementChild;
      cacca = first_tr.children;
      table_body.append(first_tr.cloneNode(true)); //clona riga

      cacca = Array.isArray(cacca) ? cacca : Object.values(cacca); //semplifica l'oggetto in array o quello che è
      cacca[0].firstElementChild.value = get_date(); //ficca la data nel primo elemento della riga che hai appena dichiarato
      cacca[6].firstElementChild.hidden = true; //nascondi il bottone '+'

    //metti nel placeholder della nuova riga, i valori della riga precedente
      let last_tr = table_body.lastElementChild;
        ultimo  = last_tr.children;

      ultimo = Array.isArray(ultimo) ? ultimo : Object.values(ultimo);
    //metti come placeholder i valori della riga prima, e i placeholder lasciati vuoti falli valori
    for (let i = 0; i < 5; i++) {
      if (cacca[i].firstElementChild.value === "") {
        cacca[i].firstElementChild.value=cacca[i].firstElementChild.placeholder;
      }
      ultimo[i].firstElementChild.placeholder = cacca[i].firstElementChild.value;
    }
    for (let i = 0; i < 6; i++) {
      ultimo[i].firstElementChild.value = "";
    }
      ultimo[1].firstElementChild.children[0].text = dlookup(cacca[1].firstElementChild.value); // clona FINALMENTE la tendina esercizio
      ultimo[1].firstElementChild.removeAttribute("required"); //togli il required che tanto l'empty space non c'è più
  }
  function togliplaceholder(){
    let first_tr    = table_body.lastElementChild;
        cacca       = first_tr.children;

      cacca = Array.isArray(cacca) ? cacca : Object.values(cacca); //semplifica l'oggetto in array o quello che è
    for (let i = 0; i < 5; i++) { // placeholder lasciati vuoti diventano valori
      if (cacca[i].firstElementChild.value === "") {
        cacca[i].firstElementChild.value=cacca[i].firstElementChild.placeholder;
      }
    }
  }
  setInterval(get_date1, 1000) //aggiorna get_date ogni 1 secondo
  </script>
</body>
</html>

